<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced My Emp Links - K RAJESH KUMAR</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        .content {
            padding: 30px;
        }
        .rajesh-section {
            background: #e8f5e8;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            border-left: 6px solid #388e3c;
        }
        .rajesh-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        .rajesh-icon {
            width: 32px;
            height: 32px;
            background: #388e3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: bold;
        }
        .rajesh-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        .rajesh-info {
            color: #7f8c8d;
            margin-bottom: 16px;
            font-size: 14px;
        }
        .summary-box {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
        }
        .summary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
        }
        .stat-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            font-weight: 500;
        }
        .stat-manage {
            background: #e8f5e8;
            color: #27ae60;
        }
        .stat-data {
            background: #e3f2fd;
            color: #3498db;
        }
        .stat-work {
            background: #fff3e0;
            color: #e67e22;
        }
        .total-stat {
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e74c3c;
        }
        .section-indicator {
            width: 4px;
            height: 24px;
            background: #e74c3c;
            margin-right: 12px;
        }
        .section-text {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        .permission-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 6px solid #3498db;
            transition: transform 0.2s ease;
        }
        .permission-card:hover {
            transform: translateY(-2px);
        }
        .permission-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        .permission-icon {
            width: 48px;
            height: 48px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 24px;
        }
        .permission-content {
            flex: 1;
        }
        .permission-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }
        .permission-type {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        .permission-description {
            color: #34495e;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        .permission-status {
            display: inline-block;
            background: #e8f5e8;
            color: #27ae60;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .manage-card {
            border-left-color: #27ae60;
        }
        .manage-icon {
            background: #e8f5e8;
            color: #27ae60;
        }
        .manage-type {
            background: #27ae60;
        }
        .data-card {
            border-left-color: #3498db;
        }
        .data-icon {
            background: #e3f2fd;
            color: #3498db;
        }
        .data-type {
            background: #3498db;
        }
        .work-card {
            border-left-color: #e67e22;
        }
        .work-icon {
            background: #fff3e0;
            color: #e67e22;
        }
        .work-type {
            background: #e67e22;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
        }
        .test-form {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 4px;
        }
        .form-group input, .form-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .btn-primary {
            background: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #27ae60;
            color: white;
        }
        .btn-success:hover {
            background: #229954;
        }
        .result {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            border-left: 4px solid #3498db;
        }
        .result.success {
            border-left-color: #27ae60;
        }
        .result.error {
            border-left-color: #e74c3c;
        }
        .flow-diagram {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .flow-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
        }
        .flow-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .flow-step {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .step-number {
            background: #3498db;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
        }
        .step-text {
            flex: 1;
            font-size: 14px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Enhanced My Emp Links</h1>
            <p>K RAJESH KUMAR - Managing Director (Employee ID: 10000 | User ID: 8)</p>
        </div>

        <div class="content">
            <!-- K RAJESH KUMAR Special Section -->
            <div class="rajesh-section">
                <div class="rajesh-header">
                    <div class="rajesh-icon">👤</div>
                    <div class="rajesh-title">K RAJESH KUMAR - Managing Director</div>
                </div>
                <div class="rajesh-info">Employee ID: 10000 | User ID: 8 | Status: Active</div>
                
                <!-- Permissions Summary Box -->
                <div class="summary-box">
                    <div class="summary-title">📊 Permissions Summary</div>
                    <div class="summary-stats">
                        <div class="stat-item stat-manage" id="manageCount">Manage: 0</div>
                        <div class="stat-item stat-data" id="dataCount">Data: 0</div>
                        <div class="stat-item stat-work" id="workCount">Work: 0</div>
                    </div>
                    <div class="total-stat" id="totalCount">Total Permissions: 0</div>
                </div>
            </div>

            <!-- Granted Permissions Section -->
            <div class="section-title">
                <div class="section-indicator"></div>
                <div class="section-text">Granted Permissions</div>
            </div>

            <div class="permissions-grid" id="permissionsGrid">
                <!-- Permissions will be loaded here -->
            </div>

            <!-- Flow Diagram -->
            <div class="flow-diagram">
                <div class="flow-title">🔄 How to Grant Permissions</div>
                <div class="flow-steps">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-text">Go to <strong>Active User Lists</strong> panel</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-text">Find <strong>K RAJESH KUMAR</strong> in the list</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-text">Select <strong>"Emp Manage Permission"</strong> in Action dropdown</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-text">Check the desired permission checkboxes</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-text">Permissions will appear in <strong>My Emp Links</strong> panel</div>
                    </div>
                </div>
            </div>

            <!-- Test Section -->
            <div class="test-section">
                <div class="test-title">🧪 Test Permissions</div>
                <div class="test-form">
                    <div class="form-group">
                        <label>User ID:</label>
                        <input type="text" id="userId" value="8" placeholder="Enter user ID">
                    </div>
                    <div class="form-group">
                        <label>Icon ID:</label>
                        <input type="text" id="iconId" value="1" placeholder="Enter icon ID">
                    </div>
                    <div class="form-group">
                        <label>Permission:</label>
                        <select id="permissionStatus">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="updatePermission()">Update Permission</button>
                    <button class="btn btn-success" onclick="fetchPermissions()">Fetch Permissions</button>
                </div>
                <div id="testResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample permissions data for demonstration
        const samplePermissions = [
            {
                id: "1",
                icon_name: "User Management",
                icon_image: "user_icon.png",
                icon_description: "Manage user accounts, roles, and permissions across the system",
                has_permission: "Yes",
                type: "Manage"
            },
            {
                id: "2",
                icon_name: "Data Analytics",
                icon_image: "analytics_icon.png",
                icon_description: "Access to comprehensive data analytics and reporting tools",
                has_permission: "Yes",
                type: "Data"
            },
            {
                id: "3",
                icon_name: "Workflow Management",
                icon_image: "workflow_icon.png",
                icon_description: "Create and manage business workflows and processes",
                has_permission: "Yes",
                type: "Work"
            },
            {
                id: "4",
                icon_name: "System Settings",
                icon_image: "settings_icon.png",
                icon_description: "Configure system-wide settings and preferences",
                has_permission: "Yes",
                type: "Manage"
            }
        ];

        // Initialize the page
        window.onload = function() {
            displayPermissions(samplePermissions);
            updateSummary();
        };

        function displayPermissions(permissions) {
            const grid = document.getElementById('permissionsGrid');
            grid.innerHTML = '';

            if (permissions.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">No permissions found. Follow the steps above to grant permissions.</div>';
                return;
            }

            permissions.forEach(permission => {
                const card = createPermissionCard(permission);
                grid.appendChild(card);
            });
        }

        function createPermissionCard(permission) {
            const card = document.createElement('div');
            card.className = `permission-card ${permission.type.toLowerCase()}-card`;

            const iconClass = `${permission.type.toLowerCase()}-icon`;
            const typeClass = `${permission.type.toLowerCase()}-type`;

            card.innerHTML = `
                <div class="permission-header">
                    <div class="permission-icon ${iconClass}">
                        ${getIconEmoji(permission.type)}
                    </div>
                    <div class="permission-content">
                        <div class="permission-name">${permission.icon_name}</div>
                        <div class="permission-type ${typeClass}">${permission.type} Icon</div>
                    </div>
                </div>
                <div class="permission-description">${permission.icon_description}</div>
                <div class="permission-status">✓ Granted</div>
            `;

            return card;
        }

        function getIconEmoji(type) {
            switch (type) {
                case 'Manage': return '⚙️';
                case 'Data': return '📊';
                case 'Work': return '💼';
                default: return '🔧';
            }
        }

        function updateSummary() {
            const manageCount = samplePermissions.filter(p => p.type === 'Manage' && p.has_permission === 'Yes').length;
            const dataCount = samplePermissions.filter(p => p.type === 'Data' && p.has_permission === 'Yes').length;
            const workCount = samplePermissions.filter(p => p.type === 'Work' && p.has_permission === 'Yes').length;
            const total = manageCount + dataCount + workCount;

            document.getElementById('manageCount').textContent = `Manage: ${manageCount}`;
            document.getElementById('dataCount').textContent = `Data: ${dataCount}`;
            document.getElementById('workCount').textContent = `Work: ${workCount}`;
            document.getElementById('totalCount').textContent = `Total Permissions: ${total}`;
        }

        async function updatePermission() {
            const userId = document.getElementById('userId').value.trim();
            const iconId = document.getElementById('iconId').value.trim();
            const hasPermission = document.getElementById('permissionStatus').value;

            if (!userId || !iconId) {
                showResult('Please enter both User ID and Icon ID', 'error');
                return;
            }

            try {
                const response = await fetch('https://emp.kfinone.com/mobile/api/update_icon_permission.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        iconId: iconId,
                        hasPermission: hasPermission
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showResult('✅ Permission updated successfully! Now check My Emp Links panel.', 'success');
                    // Refresh permissions after a short delay
                    setTimeout(() => {
                        fetchPermissions();
                    }, 1000);
                } else {
                    showResult(`❌ Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Network error: ${error.message}`, 'error');
            }
        }

        async function fetchPermissions() {
            const userId = document.getElementById('userId').value.trim();
            
            if (!userId) {
                showResult('Please enter a User ID', 'error');
                return;
            }

            try {
                const response = await fetch('https://emp.kfinone.com/mobile/api/get_user_permissions_simple.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showResult('✅ Permissions fetched successfully! Check the permissions above.', 'success');
                    
                    // Update the display with real data
                    const allPermissions = [];
                    if (data.data.manage_icons) {
                        data.data.manage_icons.forEach(icon => {
                            if (icon.has_permission === 'Yes') {
                                allPermissions.push({
                                    ...icon,
                                    type: 'Manage'
                                });
                            }
                        });
                    }
                    if (data.data.data_icons) {
                        data.data.data_icons.forEach(icon => {
                            if (icon.has_permission === 'Yes') {
                                allPermissions.push({
                                    ...icon,
                                    type: 'Data'
                                });
                            }
                        });
                    }
                    if (data.data.work_icons) {
                        data.data.work_icons.forEach(icon => {
                            if (icon.has_permission === 'Yes') {
                                allPermissions.push({
                                    ...icon,
                                    type: 'Work'
                                });
                            }
                        });
                    }
                    
                    displayPermissions(allPermissions);
                    updateSummaryWithRealData(allPermissions);
                } else {
                    showResult(`❌ Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Network error: ${error.message}`, 'error');
            }
        }

        function updateSummaryWithRealData(permissions) {
            const manageCount = permissions.filter(p => p.type === 'Manage').length;
            const dataCount = permissions.filter(p => p.type === 'Data').length;
            const workCount = permissions.filter(p => p.type === 'Work').length;
            const total = manageCount + dataCount + workCount;

            document.getElementById('manageCount').textContent = `Manage: ${manageCount}`;
            document.getElementById('dataCount').textContent = `Data: ${dataCount}`;
            document.getElementById('workCount').textContent = `Work: ${workCount}`;
            document.getElementById('totalCount').textContent = `Total Permissions: ${total}`;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html> 